# Notion CLI

A human and agent-friendly CLI for exploring Notion workspaces. Search for pages, read their content, and query databases.

### What you can do with it

- **Search** — Find pages by keyword across everything the integration can access
- **Read pages** — Fetch page metadata, properties, and content blocks (including nested blocks)
- **Query databases** — View a database's schema and page through its entries
- **Map a workspace** — Find root pages and traverse the tree to build a map of all workspace content
- **Feed an AI agent** — Give an agent the CLI and let it autonomously explore a workspace to answer questions, summarize content, or extract data
- **Audit or export** — Walk every page to check for stale content, missing properties, or generate a plaintext export

## How it works

The API clients under `src/postman/notion-api/` were generated by [Postman Code](https://www.postman.com/explore/code). The [Notion API Collection](https://www.postman.com/notionhq/notion-s-api-workspace/collection/a1b2c3d/notion-api) is the source of truth — Postman Code reads a request from the collection and produces an on-demand, type-safe TypeScript function with typed parameters, response types, and error handling. Each request becomes its own `client.ts` file.

Those generated clients are re-exported through an `index.ts` file that namespaces them by resource, so introspection and calling feels natural:

```typescript
import { notion } from "./src/postman/notion-api/index.js";

// Search across the workspace
const results = await notion.search(token, "2022-02-22", {
  query: "meeting notes",
  filter: { value: "page", property: "object" },
});

// Retrieve a database schema and query its entries
const schema = await notion.databases.retrieve(databaseId, token);
const entries = await notion.databases.query(databaseId, token, "2022-02-22", {
  page_size: 50,
});

// Read a page and its content blocks
const page = await notion.pages.retrieve(pageId, token);
const blocks = await notion.blocks.retrieveChildren(pageId, token);
```

All types are also exported from the same entry point:

```typescript
import { notion, type NotionPage, type NotionDatabase } from "./src/postman/notion-api/index.js";
```

The CLI commands in `commands/` are thin wrappers around these clients — they handle argument parsing and output formatting, while the generated code handles all the HTTP details.

## Getting Started

### 1. Clone and Install

```bash
git clone https://github.com/postmanlabs/postman-code-examples.git
cd postman-code-examples/notion-cli
npm install
```

### 2. Make the `notion-cli` Command Available

This project isn't published to npm (yet), so use `npm link` to make the `notion-cli` command available globally on your machine:

```bash
npm link
```

This builds the project and creates a symlink so you can run `notion-cli` from anywhere. To remove it later, run `npm unlink -g notion-cli`.

### 3. Create a Notion Integration

1. Go to [notion.so/my-integrations](https://www.notion.so/my-integrations)
2. Click "New integration"
3. Give it a name (e.g., "notion-cli")
4. Select the workspace you want to access
5. Under "Capabilities", enable "Read content"
6. Click "Submit" and copy the "Internal Integration Secret"

### 4. Share Pages with Your Integration

Your integration can only access pages that have been explicitly shared with it:

1. Open a page or database in Notion
2. Click the `•••` menu in the top right
3. Select "Add connections"
4. Find and select your integration

> **Tip**: Share a top-level page to give access to all its children.

### 5. Set Your API Key

Save your Notion integration token:

```bash
notion-cli set-token
```

This prompts for your token with masked input and stores it in `~/.notion-cli/config.json` so it's available from any directory. You can also pass the token directly (`notion-cli set-token <token>`) or set the `NOTION_API_KEY` environment variable, which takes precedence over the stored token.

## Usage

### search

Search for pages or find workspace roots:

```bash
# List pages the integration can access (via the Search API)
notion-cli search

# Search by keyword
notion-cli search "meeting notes"

# Find only top-level workspace pages (roots)
notion-cli search --workspace
```

The `--workspace` flag paginates through results internally and returns only pages whose parent is the workspace — these are your starting points for building a sitemap.

### page get

Read a page's content:

```bash
notion-cli page get <page-id>

# Output raw JSON
notion-cli page get <page-id> --raw
```

Shows page metadata (title, ID, parent, dates, URL), all properties, and content blocks with formatting. Child pages and databases are listed with their IDs for further navigation. The command recursively fetches nested blocks (toggles, callouts, etc.) but stops at child pages and databases.

### database get

View a database's metadata and schema:

```bash
notion-cli database get <database-id>

# Output raw JSON
notion-cli database get <database-id> --raw
```

Shows the database title, ID, parent, dates, URL, and schema (property names and types). Use `database list` to see the entries.

### database list

List entries in a database:

```bash
notion-cli database list <database-id>

# Limit results
notion-cli database list <database-id> --limit 50

# Paginate through entries
notion-cli database list <database-id> --cursor <cursor>
```

Shows entries with titles, IDs, property values, and URLs. Each entry is a Notion page — use `page get <entry-id>` to read its full content.

## Example workflow: mapping a workspace

The Notion API doesn't have a "list all pages" endpoint, so mapping a workspace typically starts by finding pages whose parent is the workspace, then recursively reading child pages.

If you want a workspace sitemap, the high-level loop looks like this:

```bash
# 1. Find root pages
notion-cli search --workspace

# 2. Read each root page to discover its children
notion-cli page get <root-id>

# 3. View a database's schema
notion-cli database get <db-id>

# 4. List entries in a database
notion-cli database list <db-id>

# 5. Read an entry or child page
notion-cli page get <child-id>
```

For AI agents: run `notion-cli --help` — it includes the full workspace mapping workflow, command details, and examples. Each subcommand also has its own `--help` with detailed usage.

## Development

If you want to modify the CLI, use `npm run cli` during development to run from source without rebuilding:

```bash
npm run cli -- search --workspace
npm run cli -- page get <page-id>
npm run cli -- database list <database-id>
```

After making changes, rebuild with `npm run build` to update the linked `notion-cli` command.

## Project Structure

```
notion-cli/
├── cli.ts                           # Main CLI application
├── commands/                        # CLI command handlers
├── helpers.ts                       # Shared formatting utilities
├── src/postman/notion-api/          # Generated API clients
│   ├── index.ts                     # notion object with client functions
│   ├── blocks/retrieve-block-children/client.ts
│   ├── databases/
│   │   ├── retrieve-database/client.ts
│   │   └── query-database/client.ts
│   ├── pages/retrieve-page/client.ts
│   ├── search/search/client.ts
│   └── shared/types.ts
└── package.json
```

## Troubleshooting

### "No Notion API key found"

Run `notion-cli set-token <your-token>` or set the `NOTION_API_KEY` environment variable.

### "Unauthorized" or "Forbidden" errors

- Verify your integration token is correct
- Make sure pages are shared with your integration

### No pages found

Your integration can only see pages explicitly shared with it. Share a top-level page to access its children.

## License

MIT
